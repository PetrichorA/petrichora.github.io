<!DOCTYPE html><html lang=zh><head><meta http-equiv=Content-Type content="text/html; charset=UTF-8"><title>题解</title><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@fec99e52afaf34c19d3569d7d7a81cae8e260bc7/62/69/e2/60/6269e2605d44dfe9f8cfc500574cfe837f8da1cf7ccceddf42582b85ae389b3d.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@8c10797495a2d9da828234a90d7875624b632b7f/42/ec/03/78/42ec0378a7ed94202cc94ee90cdf57e5b9c36b3827bcd0b53a17ac2c5de81035.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@92276ad4c3654c248e9cebd425ae9449475274f9/f1/48/fe/a7/f148fea7fcf0699d4f5d6ce9022d6ec9fed380b5b05355df82006d7c6ddb10ac.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@c2cbf7b3ebfe9743283b0a87a580f013ba2b5712/87/26/22/8b/8726228bc63aab1f6298e15d7bfac9d36bc6fc6b393c34ae2e6c58bb752c895a.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/PetrichorA/page-648446cf@0.0.1/katex/katex.min.css><script defer src=https://cdn.jsdelivr.net/gh/PetrichorA/page-648446cf@0.0.1/katex/katex.min.js></script></head><body rlt=1> <div id=user_list> <a href=# class="list-group-item active" value=668> thr31 ♥10 </a> <a href=# class=list-group-item value=667>5888213086♥9</a> <a href=# class=list-group-item value=665>admin♥4</a> </div> <div id=layout> <div id=test-editormd-view class="markdown-body editormd-html-preview"> <h2 id=h2-u9898u610F><a name=题意 class=reference-link></a><span class="header-link octicon octicon-link"></span>题意</h2> <p>这道题题目有点绕，实际就是找出一种方案，使得从根节点出发的路径的最大值最小，答案即该最大值的最小值。</p> <h2 id=h2-u8D2Au5FC3><a name=贪心 class=reference-link></a><span class="header-link octicon octicon-link"></span>贪心</h2> <p>这道题的先进滑道是可以贪心建造的。</p> <p>设<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>p</mi> <mo stretchy=false>[</mo> <mi>x</mi> <mo stretchy=false>]</mo> </mrow> <annotation encoding=application/x-tex>dp[x]</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class=mopen>[</span><span class="mord mathnormal">x</span><span class=mclose>]</span></span></span></span></span>为从<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>x</mi> </mrow> <annotation encoding=application/x-tex>x</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span></span></span></span></span>出发往下的路径在最优情况下的最大值。</p> <p>对于一个节点<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>x</mi> </mrow> <annotation encoding=application/x-tex>x</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span></span></span></span></span>，假设它的儿子的子树全部都已经为最优方案，那么为了使<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>x</mi> </mrow> <annotation encoding=application/x-tex>x</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span></span></span></span></span>出去的路径的最大值最小，对于所有<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>x</mi> </mrow> <annotation encoding=application/x-tex>x</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span></span></span></span></span>的儿子<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>y</mi> </mrow> <annotation encoding=application/x-tex>y</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span></span></span></span></span>，一定要把先进滑道通向<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>p</mi> <mo stretchy=false>[</mo> <mi>y</mi> <mo stretchy=false>]</mo> </mrow> <annotation encoding=application/x-tex>dp[y]</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class=mopen>[</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class=mclose>]</span></span></span></span></span>最大的儿子，否则<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>p</mi> <mo stretchy=false>[</mo> <mi>y</mi> <mo stretchy=false>]</mo> </mrow> <annotation encoding=application/x-tex>dp[y]</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span><span class=mopen>[</span><span class="mord mathnormal" style="margin-right: 0.03588em;">y</span><span class=mclose>]</span></span></span></span></span>最大的儿子传到<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>x</mi> </mrow> <annotation encoding=application/x-tex>x</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">x</span></span></span></span></span>的值一定比当前大。</p> <p>因此一个节点的先进滑道一定是连向dp值最大的儿子。</p> <h2 id=h2--dp><a name=树形DP class=reference-link></a><span class="header-link octicon octicon-link"></span>树形DP</h2> <p>有了上一步的贪心，可以发现，求每个节点的dp值，必须要所有它的儿子的dp值，因此用树形dp求解。</p> <p>由于一条全是先进滑道的链（以下称作先进链）的权值只能通过该先进链的长度求取，并不能拆成几段分开求解。因此从一个点往下的所有先进链上的点都要存下来。</p> <p>由于每个点只会向一个儿子连出一条先进边，根据启发式合并的思想，应该把父亲加到儿子的<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>v</mi> <mi>e</mi> <mi>c</mi> <mi>t</mi> <mi>o</mi> <mi>r</mi> </mrow> <annotation encoding=application/x-tex>vector</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span></span></span></span></span>中，再把父亲指向儿子的<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>v</mi> <mi>e</mi> <mi>c</mi> <mi>t</mi> <mi>o</mi> <mi>r</mi> </mrow> <annotation encoding=application/x-tex>vector</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span></span></span></span></span>。这样每个点加一条先进边复杂度是<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>O</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>O(1)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">O</span><span class=mopen>(</span><span class=mord>1</span><span class=mclose>)</span></span></span></span></span>的。</p> <p>但是，如果直接把<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>v</mi> <mi>e</mi> <mi>c</mi> <mi>t</mi> <mi>o</mi> <mi>r</mi> </mrow> <annotation encoding=application/x-tex>vector</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.61508em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span></span></span></span></span>中的所有点都把父亲更新一遍，显然会超时。 </p> <p>考虑<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>b</mi> <mo>=</mo> <mo stretchy=false>⌈</mo> <msub> <mo> <mi>log</mi> <mo>⁡</mo> </mo> <mn>2</mn> </msub> <mi>a</mi> <mo stretchy=false>⌉</mo> </mrow> <annotation encoding=application/x-tex>b=\lceil \log_2a \rceil</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">b</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class=mopen>⌈</span><span class=mop><span class=mop>lo<span style="margin-right: 0.01389em;">g</span></span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style="height: 0.206968em;"><span class style="top: -2.45586em; margin-right: 0.05em;"><span class=pstrut style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style="height: 0.24414em;"><span class></span></span></span></span></span></span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">a</span><span class=mclose>⌉</span></span></span></span></span>。<br>在<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>a</mi> <mo>=</mo> <mi>a</mi> <mo>+</mo> <mn>1</mn> </mrow> <annotation encoding=application/x-tex>a=a+1</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">a</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathnormal">a</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 0.64444em; vertical-align: 0em;"></span><span class=mord>1</span></span></span></span></span>时，只有<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>a</mi> </mrow> <annotation encoding=application/x-tex>a</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">a</span></span></span></span></span>为二的幂或零时，<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>b</mi> </mrow> <annotation encoding=application/x-tex>b</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathnormal">b</span></span></span></span></span>才会+1。</p> <p>因此，我们只需在把离儿子节点距离为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <msup> <mn>2</mn> <mi>k</mi> </msup> </mrow> <annotation encoding=application/x-tex>2^k</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.849108em; vertical-align: 0em;"></span><span class=mord><span class=mord>2</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style="height: 0.849108em;"><span class style="top: -3.063em; margin-right: 0.05em;"><span class=pstrut style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span>和<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mn>0</mn> </mrow> <annotation encoding=application/x-tex>0</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.64444em; vertical-align: 0em;"></span><span class=mord>0</span></span></span></span></span>的位置的值重新更新给父亲，其它都沿用儿子的dp值即可。</p> <p>这样每个点都只从<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>l</mi> <mi>o</mi> <mi>g</mi> </mrow> <annotation encoding=application/x-tex>log</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span></span></span></span></span>个点更新。<br>总复杂度为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>O</mi> <mo stretchy=false>(</mo> <mi>n</mi> <mo>×</mo> <mi>l</mi> <mi>o</mi> <mi>g</mi> <mtext>&nbsp;</mtext> <mi>n</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>O(n \times log\ n)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">O</span><span class=mopen>(</span><span class="mord mathnormal">n</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>×</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right: 0.03588em;">g</span><span class=mspace>&nbsp;</span><span class="mord mathnormal">n</span><span class=mclose>)</span></span></span></span></span>。</p> <h2 id=h2-u4EE3u7801><a name=代码 class=reference-link></a><span class="header-link octicon octicon-link"></span>代码</h2> <pre class="prettyprint linenums prettyprinted"><ol class=linenums><li class=L0><code class=lang-cpp><span class=com>#include</span><span class=pun>&lt;</span><span class=pln>bits</span><span class=pun>/</span><span class=pln>stdc</span><span class=pun>++.</span><span class=pln>h</span><span class=pun>&gt;</span></code></li><li class=L1><code class=lang-cpp><span class=com>#define</span><span class=pln> M </span><span class=lit>100005</span></code></li><li class=L2><code class=lang-cpp><span class=kwd>using</span><span class=pln> </span><span class=kwd>namespace</span><span class=pln> std</span><span class=pun>;</span></code></li><li class=L3><code class=lang-cpp><span class=kwd>void</span><span class=pln> </span><span class=typ>Max</span><span class=pun>(</span><span class=typ>int</span><span class=pln> </span><span class=pun>&amp;</span><span class=pln>a</span><span class=pun>,</span><span class=typ>int</span><span class=pln> b</span><span class=pun>){</span></code></li><li class=L4><code class=lang-cpp><span class=pln>    b</span><span class=pun>&gt;</span><span class=pln>a</span><span class=pun>&amp;&amp;(</span><span class=pln>a</span><span class=pun>=</span><span class=pln>b</span><span class=pun>);</span></code></li><li class=L5><code class=lang-cpp><span class=pun>}</span></code></li><li class=L6><code class=lang-cpp><span class=typ>int</span><span class=pln> hd</span><span class=pun>[</span><span class=pln>M</span><span class=pun>],</span><span class=pln>nxt</span><span class=pun>[</span><span class=pln>M</span><span class=pun>+</span><span class=pln>M</span><span class=pun>],</span><span class=pln>to</span><span class=pun>[</span><span class=pln>M</span><span class=pun>+</span><span class=pln>M</span><span class=pun>],</span><span class=pln>cnte</span><span class=pun>;</span></code></li><li class=L7><code class=lang-cpp><span class=kwd>void</span><span class=pln> addedge</span><span class=pun>(</span><span class=typ>int</span><span class=pln> a</span><span class=pun>,</span><span class=typ>int</span><span class=pln> b</span><span class=pun>){</span></code></li><li class=L8><code class=lang-cpp><span class=pln>    nxt</span><span class=pun>[++</span><span class=pln>cnte</span><span class=pun>]=</span><span class=pln>hd</span><span class=pun>[</span><span class=pln>a</span><span class=pun>];</span></code></li><li class=L9><code class=lang-cpp><span class=pln>    to</span><span class=pun>[</span><span class=pln>cnte</span><span class=pun>]=</span><span class=pln>b</span><span class=pun>;</span></code></li><li class=L0><code class=lang-cpp><span class=pln>    hd</span><span class=pun>[</span><span class=pln>a</span><span class=pun>]=</span><span class=pln>cnte</span><span class=pun>;</span></code></li><li class=L1><code class=lang-cpp><span class=pun>}</span></code></li><li class=L2><code class=lang-cpp><span class=typ>int</span><span class=pln> n</span><span class=pun>;</span></code></li><li class=L3><code class=lang-cpp><span class=typ>int</span><span class=pln> p</span><span class=pun>[</span><span class=pln>M</span><span class=pun>],</span><span class=pln>dp</span><span class=pun>[</span><span class=pln>M</span><span class=pun>];</span></code></li><li class=L4><code class=lang-cpp><span class=typ>vector</span><span class=str>&lt;int&gt;</span><span class=pln> S</span><span class=pun>[</span><span class=pln>M</span><span class=pun>];</span></code></li><li class=L5><code class=lang-cpp><span class=kwd>void</span><span class=pln> dfs</span><span class=pun>(</span><span class=typ>int</span><span class=pln> x</span><span class=pun>,</span><span class=typ>int</span><span class=pln> f</span><span class=pun>){</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    </span><span class=typ>int</span><span class=pln> </span><span class=typ>Son</span><span class=pun>=</span><span class=lit>0</span><span class=pun>,</span><span class=pln>mx</span><span class=pun>=-</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L7><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=pln>hd</span><span class=pun>[</span><span class=pln>x</span><span class=pun>];</span><span class=pln>i</span><span class=pun>;</span><span class=pln>i</span><span class=pun>=</span><span class=pln>nxt</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]){</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        </span><span class=typ>int</span><span class=pln> y</span><span class=pun>=</span><span class=pln>to</span><span class=pun>[</span><span class=pln>i</span><span class=pun>];</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>y</span><span class=pun>==</span><span class=pln>f</span><span class=pun>)</span><span class=kwd>continue</span><span class=pun>;</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        dfs</span><span class=pun>(</span><span class=pln>y</span><span class=pun>,</span><span class=pln>x</span><span class=pun>);</span></code></li><li class=L1><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>dp</span><span class=pun>[</span><span class=pln>y</span><span class=pun>]&gt;</span><span class=pln>dp</span><span class=pun>[</span><span class=typ>Son</span><span class=pun>])</span><span class=typ>Son</span><span class=pun>=</span><span class=pln>y</span><span class=pun>;</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=pln>hd</span><span class=pun>[</span><span class=pln>x</span><span class=pun>];</span><span class=pln>i</span><span class=pun>;</span><span class=pln>i</span><span class=pun>=</span><span class=pln>nxt</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]){</span></code></li><li class=L4><code class=lang-cpp><span class=pln>        </span><span class=typ>int</span><span class=pln> y</span><span class=pun>=</span><span class=pln>to</span><span class=pun>[</span><span class=pln>i</span><span class=pun>];</span></code></li><li class=L5><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>y</span><span class=pun>==</span><span class=pln>f</span><span class=pun>||</span><span class=pln>y</span><span class=pun>==</span><span class=typ>Son</span><span class=pun>)</span><span class=kwd>continue</span><span class=pun>;</span></code></li><li class=L6><code class=lang-cpp><span class=pln>        </span><span class=typ>Max</span><span class=pun>(</span><span class=pln>mx</span><span class=pun>,</span><span class=pln>dp</span><span class=pun>[</span><span class=pln>y</span><span class=pun>]);</span></code></li><li class=L7><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L8><code class=lang-cpp><span class=pln>    </span><span class=kwd>if</span><span class=pun>(!</span><span class=typ>Son</span><span class=pun>){</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        S</span><span class=pun>[</span><span class=pln>x</span><span class=pun>].</span><span class=pln>push_back</span><span class=pun>(</span><span class=lit>0</span><span class=pun>);</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        dp</span><span class=pun>[</span><span class=pln>x</span><span class=pun>]=</span><span class=lit>0</span><span class=pun>;</span></code></li><li class=L1><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    </span><span class=kwd>else</span><span class=pln> </span><span class=pun>{</span></code></li><li class=L3><code class=lang-cpp><span class=pln>        p</span><span class=pun>[</span><span class=pln>x</span><span class=pun>]=</span><span class=pln>p</span><span class=pun>[</span><span class=typ>Son</span><span class=pun>];</span></code></li><li class=L4><code class=lang-cpp><span class=pln>        dp</span><span class=pun>[</span><span class=pln>x</span><span class=pun>]=</span><span class=pln>max</span><span class=pun>(</span><span class=pln>mx</span><span class=pun>+</span><span class=lit>1</span><span class=pun>,</span><span class=pln>dp</span><span class=pun>[</span><span class=typ>Son</span><span class=pun>]);</span></code></li><li class=L5><code class=lang-cpp><span class=pln>        </span><span class=typ>int</span><span class=pln> sz</span><span class=pun>=</span><span class=pln>S</span><span class=pun>[</span><span class=pln>p</span><span class=pun>[</span><span class=pln>x</span><span class=pun>]].</span><span class=pln>size</span><span class=pun>();</span></code></li><li class=L6><code class=lang-cpp><span class=pln>        </span><span class=typ>Max</span><span class=pun>(</span><span class=pln>dp</span><span class=pun>[</span><span class=pln>x</span><span class=pun>],</span><span class=pln>S</span><span class=pun>[</span><span class=pln>p</span><span class=pun>[</span><span class=pln>x</span><span class=pun>]][</span><span class=pln>sz</span><span class=pun>-</span><span class=lit>1</span><span class=pun>]+</span><span class=lit>1</span><span class=pun>);</span><span class=com>//从零更新 </span></code></li><li class=L7><code class=lang-cpp><span class=pln>        </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=lit>0</span><span class=pun>;(</span><span class=lit>1</span><span class=pun>&lt;&lt;</span><span class=pln>i</span><span class=pun>)&lt;</span><span class=pln>sz</span><span class=pun>;</span><span class=pln>i</span><span class=pun>++)</span></code></li><li class=L8><code class=lang-cpp><span class=pln>            </span><span class=typ>Max</span><span class=pun>(</span><span class=pln>dp</span><span class=pun>[</span><span class=pln>x</span><span class=pun>],</span><span class=pln>S</span><span class=pun>[</span><span class=pln>p</span><span class=pun>[</span><span class=pln>x</span><span class=pun>]][</span><span class=pln>sz</span><span class=pun>-</span><span class=lit>1</span><span class=pun>-(</span><span class=lit>1</span><span class=pun>&lt;&lt;</span><span class=pln>i</span><span class=pun>)]+</span><span class=pln>i</span><span class=pun>+</span><span class=lit>2</span><span class=pun>);</span><span class=com>//从二的幂更新 </span></code></li><li class=L9><code class=lang-cpp><span class=pln>        S</span><span class=pun>[</span><span class=pln>p</span><span class=pun>[</span><span class=pln>x</span><span class=pun>]].</span><span class=pln>push_back</span><span class=pun>(</span><span class=pln>mx</span><span class=pun>+</span><span class=lit>1</span><span class=pun>);</span></code></li><li class=L0><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L1><code class=lang-cpp><span class=pun>}</span></code></li><li class=L2><code class=lang-cpp><span class=kwd>void</span><span class=pln> init</span><span class=pun>(){</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    memset</span><span class=pun>(</span><span class=pln>dp</span><span class=pun>,</span><span class=lit>0</span><span class=pun>,</span><span class=kwd>sizeof</span><span class=pun>(</span><span class=pln>dp</span><span class=pun>));</span></code></li><li class=L4><code class=lang-cpp><span class=pln>    dp</span><span class=pun>[</span><span class=lit>0</span><span class=pun>]=-</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    cnte</span><span class=pun>=</span><span class=lit>0</span><span class=pun>;</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=lit>1</span><span class=pun>;</span><span class=pln>i</span><span class=pun>&lt;=</span><span class=pln>n</span><span class=pun>;</span><span class=pln>i</span><span class=pun>++){</span></code></li><li class=L7><code class=lang-cpp><span class=pln>        S</span><span class=pun>[</span><span class=pln>i</span><span class=pun>].</span><span class=pln>clear</span><span class=pun>();</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        hd</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]=</span><span class=pln>dp</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]=</span><span class=lit>0</span><span class=pun>;</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        p</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]=</span><span class=pln>i</span><span class=pun>;</span></code></li><li class=L0><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L1><code class=lang-cpp><span class=pun>}</span></code></li><li class=L2><code class=lang-cpp><span class=kwd>void</span><span class=pln> solve</span><span class=pun>(){</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    scanf</span><span class=pun>(</span><span class=str>"%d"</span><span class=pun>,&amp;</span><span class=pln>n</span><span class=pun>);</span></code></li><li class=L4><code class=lang-cpp><span class=pln>    init</span><span class=pun>();</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=lit>1</span><span class=pun>;</span><span class=pln>i</span><span class=pun>&lt;</span><span class=pln>n</span><span class=pun>;</span><span class=pln>i</span><span class=pun>++){</span></code></li><li class=L6><code class=lang-cpp><span class=pln>        </span><span class=typ>int</span><span class=pln> a</span><span class=pun>,</span><span class=pln>b</span><span class=pun>;</span></code></li><li class=L7><code class=lang-cpp><span class=pln>        scanf</span><span class=pun>(</span><span class=str>"%d%d"</span><span class=pun>,&amp;</span><span class=pln>a</span><span class=pun>,&amp;</span><span class=pln>b</span><span class=pun>);</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        addedge</span><span class=pun>(</span><span class=pln>a</span><span class=pun>,</span><span class=pln>b</span><span class=pun>);</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        addedge</span><span class=pun>(</span><span class=pln>b</span><span class=pun>,</span><span class=pln>a</span><span class=pun>);</span></code></li><li class=L0><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L1><code class=lang-cpp><span class=pln>    dfs</span><span class=pun>(</span><span class=lit>1</span><span class=pun>,</span><span class=lit>0</span><span class=pun>);</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    printf</span><span class=pun>(</span><span class=str>"%d\n"</span><span class=pun>,</span><span class=pln>dp</span><span class=pun>[</span><span class=lit>1</span><span class=pun>]);</span></code></li><li class=L3><code class=lang-cpp><span class=pun>}</span></code></li><li class=L4><code class=lang-cpp><span class=typ>int</span><span class=pln> main</span><span class=pun>(){</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    </span><span class=typ>int</span><span class=pln> T</span><span class=pun>;</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    scanf</span><span class=pun>(</span><span class=str>"%d"</span><span class=pun>,&amp;</span><span class=pln>T</span><span class=pun>);</span></code></li><li class=L7><code class=lang-cpp><span class=pln>    </span><span class=kwd>while</span><span class=pun>(</span><span class=pln>T</span><span class=pun>--)</span><span class=pln>solve</span><span class=pun>();</span></code></li><li class=L8><code class=lang-cpp><span class=pln>    </span><span class=kwd>return</span><span class=pln> </span><span class=lit>0</span><span class=pun>;</span></code></li><li class=L9><code class=lang-cpp><span class=pun>}</span></code></li></ol></pre> </div> </div> <div id=pickup> <div class=stars> <span class></span> </div> 点赞 </div> <script src=https://cdn.jsdelivr.net/npm/jquery@1.11.1/dist/jquery.min.js></script> <script src=https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@5c3956355afede3aa3733467597bca655f633bfb/cb/fd/a7/04/cbfda704333e625c39a933935366104bc5f249f563903479697dd65419c9e599.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@1a3cac13704cfb4581eba7c80d6a17a4875a9cb0/aa/4f/fe/8b/aa4ffe8b05ec5c82ef2083556db92978ff71f9cd0cea5aae897439e2d108405a.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@2a96d3cb5dd059f8251854bb7bee8dbe87a1eb3f/e3/a2/a0/14/e3a2a014ef7afae26a46f7f57eda5c04ab5f82aca421c75c09375957a853c2b1.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@2a0687348c9f51a49c83aefd40db290ce3e53806/01/bb/d6/4e/01bbd64ee83ea0e5328a6b76a71ff3c59471e1a4c60238533211908df7160194.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@e5c61235d73fd4ee4325f30a6a7015e41f4135d6/96/82/6e/d5/96826ed596b183c4fa45ac7cc487e9ef04d642a41cc441aa0e37ce9a220fd60a.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@4a1b5def55a106936540236baee7614eed57ab9e/f1/54/b6/33/f154b633352f533fee95c6d97e7094ec9c4e2440455c49a77f4e4942152a680c.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@3125b34f85e0baf93b75e60a0f5ef3ca86584c3d/6c/36/f3/40/6c36f340c28857f77797084c584ec0ba6d4c70943a106eadabf309c0fbf3e647.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@c86c1bdcba6cd97ce63f15c1be5af0b2c8bb440d/fc/48/48/87/fc484887d4277dcb15dd736f66974dc608579c086fc1e2bd3b221ac3e02d529c.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@e610aa8d166e0be7b5687461949ed4ea5dac9989/b3/67/4c/fe/b3674cfe25895038b937b65fd0465f7bcb8f679f4d2898cb83a111f68e38ae47.js></script> <div id=qds style=display:none;></div></body></html>