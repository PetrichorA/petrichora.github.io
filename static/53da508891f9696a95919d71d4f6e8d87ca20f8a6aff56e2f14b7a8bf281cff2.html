<!DOCTYPE html><html lang=zh><head><meta http-equiv=Content-Type content="text/html; charset=UTF-8"><title>题解</title><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@fec99e52afaf34c19d3569d7d7a81cae8e260bc7/62/69/e2/60/6269e2605d44dfe9f8cfc500574cfe837f8da1cf7ccceddf42582b85ae389b3d.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@8c10797495a2d9da828234a90d7875624b632b7f/42/ec/03/78/42ec0378a7ed94202cc94ee90cdf57e5b9c36b3827bcd0b53a17ac2c5de81035.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@92276ad4c3654c248e9cebd425ae9449475274f9/f1/48/fe/a7/f148fea7fcf0699d4f5d6ce9022d6ec9fed380b5b05355df82006d7c6ddb10ac.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/urlib/bin_8@c2cbf7b3ebfe9743283b0a87a580f013ba2b5712/87/26/22/8b/8726228bc63aab1f6298e15d7bfac9d36bc6fc6b393c34ae2e6c58bb752c895a.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/PetrichorA/page-648446cf@0.0.1/katex/katex.min.css><script defer src=https://cdn.jsdelivr.net/gh/PetrichorA/page-648446cf@0.0.1/katex/katex.min.js></script></head><body rlt=1> <div id=user_list> <a href=# class="list-group-item active" value=669> Ri_Nai ♥3 </a> </div> <div id=layout> <div id=test-editormd-view class="markdown-body editormd-html-preview"> <h4 id=h4-u9898u76EEu5927u610F><a name=题目大意 class=reference-link></a><span class="header-link octicon octicon-link"></span>题目大意</h4> <p>给出一棵以1为根的有根树,每个非叶子节点都有一条到其儿子节点的<strong>有向边</strong>.每个非根节点都有一条到根的返祖边.有<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>q</mi> </mrow> <annotation encoding=application/x-tex>q</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">q</span></span></span></span></span>个询问,每次修改一条边的权值或者查询树上两点间的最短路 </p> <h4 id=h4-u6811u4E0Au8DDDu79BB><a name=树上距离 class=reference-link></a><span class="header-link octicon octicon-link"></span>树上距离</h4> <p><img src=https://cdn.jsdelivr.net/gh/urlib/bin_8@a8f35a9999a2efb50ecfc96fd5cc2cb37c38c382/25/63/27/ec/256327ecafd61952c346d62a46c92883eb6824ce07efdc5ba2061e1ffee99002.png alt><br>按照题目大意建出一棵树<br>因为所有的树边都是有向边,所以树上的距离有如下性质<br><code>当且仅当u为v的祖先时u-&gt;v才有树上的路径</code><br>记树上距离<code>(u,v)</code>为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(u,v)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span></span></span></span></span> </p> <h4 id=h4--><a name=中转站:根 class=reference-link></a><span class="header-link octicon octicon-link"></span>中转站:根</h4> <p>每一个点都有一条到根的返祖边,设<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>的返祖边长度为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>len(u)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mclose>)</span></span></span></span></span><br>因为根是所有点的祖先,以根为中转站,<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> <mo>⇒</mo> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>u\Rightarrow v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>⇒</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>的路径可以改写成<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> <mo>⇒</mo> <mn>1</mn> <mo>⇒</mo> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>u\Rightarrow 1 \Rightarrow v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>⇒</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 0.64444em; vertical-align: 0em;"></span><span class=mord>1</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>⇒</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span><br>此时距离为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>u</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>len(u)+dis(1,u)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">u</span><span class=mclose>)</span></span></span></span></span><br>可以证明,中间只会跳到根节点一次.<br>否则距离则为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>u</mi> <mo stretchy=false>)</mo> <mo>&lt;</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>u</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex> len(u)+dis(1,p)+len(p)+dis(1,u)&lt;len(u)+dis(1,u)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">u</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>&lt;</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">u</span><span class=mclose>)</span></span></span></span></span></p> <h4 id=h4--><a name=中转站:子树 class=reference-link></a><span class="header-link octicon octicon-link"></span>中转站:子树</h4> <p><span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>是其子树所有点的祖先,故<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>可以到达其子树中的点<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>p</mi> </mrow> <annotation encoding=application/x-tex>p</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span></span>.<br>故此时<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> <mo>⇒</mo> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>u\Rightarrow v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>⇒</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>的距离为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo separator=true>,</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(u,p)+len(p)+dis(1,v)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span></span></span></span></span> </p> <h4 id=h4-u6700u77EDu8DEF><a name=最短路 class=reference-link></a><span class="header-link octicon octicon-link"></span>最短路</h4> <p>若<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>的祖先,则答案很明了<br>就是<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(u,v)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span></span></span></span></span>,因为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> <mo>&lt;</mo> <mo>=</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> <mo>&lt;</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> <mo stretchy=false>(</mo> <mi>p</mi> <mtext>在</mtext> <mi>u</mi> <mtext>的子树内</mtext> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex> dis(u,v)&lt;=dis(1,v)&lt;len(p)+dis(1,v)(p在u的子树内)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>&lt;</span></span><span class=base><span class=strut style="height: 0.36687em; vertical-align: 0em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>&lt;</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class="mord cjk_fallback">在</span><span class="mord mathnormal">u</span><span class="mord cjk_fallback">的</span><span class="mord cjk_fallback">子</span><span class="mord cjk_fallback">树</span><span class="mord cjk_fallback">内</span><span class=mclose>)</span></span></span></span></span><br>否则<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> <mo>⇒</mo> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>u\Rightarrow v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>⇒</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>的距离为<br><span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>r</mi> <mi>e</mi> <mi>s</mi> <mo>=</mo> <mi>m</mi> <mi>i</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mi>u</mi> <mo separator=true>,</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>res=min (dis(u,p)+len(p)+dis(1,v)) </annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class="mord mathnormal">u</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span><span class=mclose>)</span></span></span></span></span><br><span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>r</mi> <mi>e</mi> <mi>s</mi> <mo>=</mo> <mi>m</mi> <mi>i</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo stretchy=false>)</mo> <mo>−</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>u</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>res=min (dis(1,p)+len(p))-dis(1,u)+dis(1,v) </annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>−</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">u</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span></span></span></span></span><br><span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>u</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(1,u)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">u</span><span class=mclose>)</span></span></span></span></span>和<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>v</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(1,v)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>)</span></span></span></span></span>在查询的时候是固定的<br>故方向很明了了,只需要求<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>子树内<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>m</mi> <mi>i</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>min(dis(1,p)+len(p))</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mclose>)</span></span></span></span></span><br>由于是区间/单点更新权值,而区间查询的是最值,故用线段树维护比较方便 </p> <h4 id=h4--amp-><a name=维护&查询 class=reference-link></a><span class="header-link octicon octicon-link"></span>维护&amp;查询</h4> <h5 id=h5-u7EBFu6BB5u6811u9700u8981u7684u529Fu80FD><a name=线段树需要的功能 class=reference-link></a><span class="header-link octicon octicon-link"></span>线段树需要的功能</h5> <p>1.在修改树边的时候把整个子树的权值加上更改的权值<br>2.在修改返祖边的时候把一个点的权值加上更改的权值<br>3.区间查询整个区间的<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(1,p)+len(p)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span></span></span></span></span><br>4.单点查询某个点<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>p</mi> </mrow> <annotation encoding=application/x-tex>p</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span></span>的<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>+</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> <mo>−</mo> <mi>l</mi> <mi>e</mi> <mi>n</mi> <mo stretchy=false>(</mo> <mi>p</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(1,p)+len(p)-len(p)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>+</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span><span class=mspace style="margin-right: 0.222222em;"></span><span class=mbin>−</span><span class=mspace style="margin-right: 0.222222em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class=mopen>(</span><span class="mord mathnormal">p</span><span class=mclose>)</span></span></span></span></span></p> <p>解决的是子树的问题,故用dfs序维护即可,不需树链剖分<br>其次,判断<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>和<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>是否为祖先关系的时候也可以用dfs序<br>若<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>的dfs序在<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>的子树的dfs序区间内,则<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> </mrow> <annotation encoding=application/x-tex>u</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>为<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>的祖先<br>即<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>L</mi> <mo stretchy=false>[</mo> <mi>u</mi> <mo stretchy=false>]</mo> <mo>&lt;</mo> <mi>L</mi> <mo stretchy=false>[</mo> <mi>v</mi> <mo stretchy=false>]</mo> <mtext>&nbsp;</mtext> <mi>a</mi> <mi>n</mi> <mi>d</mi> <mtext>&nbsp;</mtext> <mi>L</mi> <mo stretchy=false>[</mo> <mi>v</mi> <mo stretchy=false>]</mo> <mo>&lt;</mo> <mo>=</mo> <mi>R</mi> <mo stretchy=false>[</mo> <mi>u</mi> <mo stretchy=false>]</mo> </mrow> <annotation encoding=application/x-tex>L[u]&lt;L[v]\ and\ L[v]&lt;=R[u] </annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">L</span><span class=mopen>[</span><span class="mord mathnormal">u</span><span class=mclose>]</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>&lt;</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">L</span><span class=mopen>[</span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>]</span><span class=mspace>&nbsp;</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class=mspace>&nbsp;</span><span class="mord mathnormal">L</span><span class=mopen>[</span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>]</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>&lt;</span></span><span class=base><span class=strut style="height: 0.36687em; vertical-align: 0em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class=mopen>[</span><span class="mord mathnormal">u</span><span class=mclose>]</span></span></span></span></span><br>由于这道题比较阴间,可能出现<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>u</mi> <mo>=</mo> <mo>=</mo> <mi>v</mi> </mrow> <annotation encoding=application/x-tex>u==v</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal">u</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>=</span></span><span class=base><span class=strut style="height: 0.36687em; vertical-align: 0em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span></span></span></span></span>的情况<br>所以这个判断是<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>L</mi> <mo stretchy=false>[</mo> <mi>u</mi> <mo stretchy=false>]</mo> <mo>&lt;</mo> <mo>=</mo> <mi>L</mi> <mo stretchy=false>[</mo> <mi>v</mi> <mo stretchy=false>]</mo> <mtext>&nbsp;</mtext> <mi>a</mi> <mi>n</mi> <mi>d</mi> <mtext>&nbsp;</mtext> <mi>L</mi> <mo stretchy=false>[</mo> <mi>v</mi> <mo stretchy=false>]</mo> <mo>&lt;</mo> <mo>=</mo> <mi>R</mi> <mo stretchy=false>[</mo> <mi>u</mi> <mo stretchy=false>]</mo> </mrow> <annotation encoding=application/x-tex>L[u]&lt;=L[v]\ and\ L[v]&lt;=R[u] </annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">L</span><span class=mopen>[</span><span class="mord mathnormal">u</span><span class=mclose>]</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>&lt;</span></span><span class=base><span class=strut style="height: 0.36687em; vertical-align: 0em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">L</span><span class=mopen>[</span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>]</span><span class=mspace>&nbsp;</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class=mspace>&nbsp;</span><span class="mord mathnormal">L</span><span class=mopen>[</span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class=mclose>]</span><span class=mspace style="margin-right: 0.277778em;"></span><span class=mrel>&lt;</span></span><span class=base><span class=strut style="height: 0.36687em; vertical-align: 0em;"></span><span class=mrel>=</span><span class=mspace style="margin-right: 0.277778em;"></span></span><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.00773em;">R</span><span class=mopen>[</span><span class="mord mathnormal">u</span><span class=mclose>]</span></span></span></span></span></p> <h4 id=h4-u4EE3u7801><a name=代码 class=reference-link></a><span class="header-link octicon octicon-link"></span>代码</h4> <p>把自己考场代码优化了一下,因为原本求<span class=editormd-tex><span class=katex style="font-size: 1.6em;"><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML> <semantics> <mrow> <mi>d</mi> <mi>i</mi> <mi>s</mi> <mo stretchy=false>(</mo> <mn>1</mn> <mo separator=true>,</mo> <mi>u</mi> <mo stretchy=false>)</mo> </mrow> <annotation encoding=application/x-tex>dis(1,u)</annotation> </semantics> </math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class=mopen>(</span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style="margin-right: 0.166667em;"></span><span class="mord mathnormal">u</span><span class=mclose>)</span></span></span></span></span>的时候用的是树状数组(因为感觉写起来比线段树方便) </p> <pre class="prettyprint linenums prettyprinted"><ol class=linenums><li class=L0><code class=lang-cpp><span class=com>#include</span><span class=pun>&lt;</span><span class=pln>bits</span><span class=pun>/</span><span class=pln>stdc</span><span class=pun>++.</span><span class=pln>h</span><span class=pun>&gt;</span></code></li><li class=L1><code class=lang-cpp><span class=kwd>using</span><span class=pln> </span><span class=kwd>namespace</span><span class=pln> std</span><span class=pun>;</span></code></li><li class=L2><code class=lang-cpp><span class=kwd>const</span><span class=pln> </span><span class=typ>int</span><span class=pln> N</span><span class=pun>=</span><span class=lit>2e5</span><span class=pun>+</span><span class=lit>5</span><span class=pun>,</span><span class=pln>M</span><span class=pun>=</span><span class=pln>N</span><span class=pun>&lt;&lt;</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L3><code class=lang-cpp><span class=kwd>typedef</span><span class=pln> </span><span class=kwd>long</span><span class=pln> </span><span class=kwd>long</span><span class=pln> LL</span><span class=pun>;</span></code></li><li class=L4><code class=lang-cpp><span class=typ>int</span><span class=pln> n</span><span class=pun>,</span><span class=pln>Q</span><span class=pun>,</span><span class=pln>fa</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>dep</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>len</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>L</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>R</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=typ>Re</span><span class=pun>[</span><span class=pln>N</span><span class=pun>];</span></code></li><li class=L5><code class=lang-cpp><span class=typ>int</span><span class=pln> nxt</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>to</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>head</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>val</span><span class=pun>[</span><span class=pln>N</span><span class=pun>],</span><span class=pln>tot</span><span class=pun>,</span><span class=pln>U</span><span class=pun>[</span><span class=pln>M</span><span class=pun>],</span><span class=pln>V</span><span class=pun>[</span><span class=pln>M</span><span class=pun>],</span><span class=pln>W</span><span class=pun>[</span><span class=pln>M</span><span class=pun>];</span></code></li><li class=L6><code class=lang-cpp><span class=pln>LL dis</span><span class=pun>[</span><span class=pln>N</span><span class=pun>];</span></code></li><li class=L7><code class=lang-cpp><span class=kwd>void</span><span class=pln> </span><span class=typ>Add</span><span class=pun>(</span><span class=typ>int</span><span class=pln> u</span><span class=pun>,</span><span class=typ>int</span><span class=pln> v</span><span class=pun>,</span><span class=typ>int</span><span class=pln> w</span><span class=pun>)</span></code></li><li class=L8><code class=lang-cpp><span class=pun>{</span></code></li><li class=L9><code class=lang-cpp><span class=pln>    nxt</span><span class=pun>[++</span><span class=pln>tot</span><span class=pun>]=</span><span class=pln>head</span><span class=pun>[</span><span class=pln>u</span><span class=pun>];</span></code></li><li class=L0><code class=lang-cpp><span class=pln>    to</span><span class=pun>[</span><span class=pln>head</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]=</span><span class=pln>tot</span><span class=pun>]=</span><span class=pln>v</span><span class=pun>;</span></code></li><li class=L1><code class=lang-cpp><span class=pln>    val</span><span class=pun>[</span><span class=pln>tot</span><span class=pun>]=</span><span class=pln>w</span><span class=pun>;</span></code></li><li class=L2><code class=lang-cpp><span class=pun>}</span></code></li><li class=L3><code class=lang-cpp><span class=kwd>void</span><span class=pln> dfs</span><span class=pun>(</span><span class=typ>int</span><span class=pln> u</span><span class=pun>,</span><span class=typ>int</span><span class=pln> f</span><span class=pun>)</span></code></li><li class=L4><code class=lang-cpp><span class=pun>{</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    dep</span><span class=pun>[</span><span class=typ>Re</span><span class=pun>[</span><span class=pln>L</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]=++</span><span class=pln>tot</span><span class=pun>]=</span><span class=pln>u</span><span class=pun>]=</span><span class=pln>dep</span><span class=pun>[</span><span class=pln>fa</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]=</span><span class=pln>f</span><span class=pun>]+</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=pln>head</span><span class=pun>[</span><span class=pln>u</span><span class=pun>];</span><span class=pln>i</span><span class=pun>;</span><span class=pln>i</span><span class=pun>=</span><span class=pln>nxt</span><span class=pun>[</span><span class=pln>i</span><span class=pun>])</span></code></li><li class=L7><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        </span><span class=typ>int</span><span class=pln> v</span><span class=pun>=</span><span class=pln>to</span><span class=pun>[</span><span class=pln>i</span><span class=pun>];</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>v</span><span class=pun>==</span><span class=pln>f</span><span class=pun>)</span><span class=kwd>continue</span><span class=pun>;</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        dis</span><span class=pun>[</span><span class=pln>v</span><span class=pun>]=</span><span class=pln>dis</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]+</span><span class=pln>val</span><span class=pun>[</span><span class=pln>i</span><span class=pun>];</span></code></li><li class=L1><code class=lang-cpp><span class=pln>        dfs</span><span class=pun>(</span><span class=pln>v</span><span class=pun>,</span><span class=pln>u</span><span class=pun>);</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span><span class=pln>R</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]=</span><span class=pln>tot</span><span class=pun>;</span></code></li><li class=L3><code class=lang-cpp><span class=pun>}</span></code></li><li class=L4><code class=lang-cpp><span class=kwd>struct</span><span class=pln> </span><span class=typ>Seg</span></code></li><li class=L5><code class=lang-cpp><span class=pun>{</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    LL </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>N</span><span class=pun>&lt;&lt;</span><span class=lit>2</span><span class=pun>],</span><span class=pln>lz</span><span class=pun>[</span><span class=pln>N</span><span class=pun>&lt;&lt;</span><span class=lit>2</span><span class=pun>];</span></code></li><li class=L7><code class=lang-cpp><span class=pln>    </span><span class=com>#define</span><span class=pln> ls p</span><span class=pun>&lt;&lt;</span><span class=lit>1</span></code></li><li class=L8><code class=lang-cpp><span class=pln>    </span><span class=com>#define</span><span class=pln> rs p</span><span class=pun>&lt;&lt;</span><span class=lit>1</span><span class=pun>|</span><span class=lit>1</span></code></li><li class=L9><code class=lang-cpp><span class=pln>    </span><span class=com>#define</span><span class=pln> </span><span class=typ>Lson</span><span class=pln> L</span><span class=pun>,</span><span class=pln>mid</span><span class=pun>,</span><span class=pln>ls</span></code></li><li class=L0><code class=lang-cpp><span class=pln>    </span><span class=com>#define</span><span class=pln> </span><span class=typ>Rson</span><span class=pln> mid</span><span class=pun>+</span><span class=lit>1</span><span class=pun>,</span><span class=pln>R</span><span class=pun>,</span><span class=pln>rs</span></code></li><li class=L1><code class=lang-cpp><span class=pln>    </span><span class=com>#define</span><span class=pln> LRP </span><span class=typ>int</span><span class=pln> L</span><span class=pun>=</span><span class=lit>1</span><span class=pun>,</span><span class=typ>int</span><span class=pln> R</span><span class=pun>=</span><span class=pln>n</span><span class=pun>,</span><span class=typ>int</span><span class=pln> p</span><span class=pun>=</span><span class=lit>1</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    </span><span class=com>//个人打线段树常用的define</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    </span><span class=kwd>void</span><span class=pln> </span><span class=typ>Chg</span><span class=pun>(</span><span class=typ>int</span><span class=pln> p</span><span class=pun>,</span><span class=typ>int</span><span class=pln> x</span><span class=pun>)</span><span class=com>//修改</span></code></li><li class=L4><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L5><code class=lang-cpp><span class=pln>        </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]+=</span><span class=pln>x</span><span class=pun>,</span><span class=pln>lz</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]+=</span><span class=pln>x</span><span class=pun>;</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L7><code class=lang-cpp><span class=pln>    </span><span class=kwd>void</span><span class=pln> </span><span class=typ>Down</span><span class=pun>(</span><span class=typ>int</span><span class=pln> p</span><span class=pun>)</span><span class=com>//延迟更新</span></code></li><li class=L8><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        LL </span><span class=pun>&amp;</span><span class=pln>t</span><span class=pun>=</span><span class=pln>lz</span><span class=pun>[</span><span class=pln>p</span><span class=pun>];</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(!</span><span class=pln>t</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=pun>;</span></code></li><li class=L1><code class=lang-cpp><span class=pln>        </span><span class=typ>Chg</span><span class=pun>(</span><span class=pln>ls</span><span class=pun>,</span><span class=pln>t</span><span class=pun>);</span></code></li><li class=L2><code class=lang-cpp><span class=pln>        </span><span class=typ>Chg</span><span class=pun>(</span><span class=pln>rs</span><span class=pun>,</span><span class=pln>t</span><span class=pun>);</span></code></li><li class=L3><code class=lang-cpp><span class=pln>        t</span><span class=pun>=</span><span class=lit>0</span><span class=pun>;</span></code></li><li class=L4><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    </span><span class=kwd>void</span><span class=pln> </span><span class=typ>Updata</span><span class=pun>(</span><span class=typ>int</span><span class=pln> l</span><span class=pun>,</span><span class=typ>int</span><span class=pln> r</span><span class=pun>,</span><span class=typ>int</span><span class=pln> x</span><span class=pun>,</span><span class=pln>LRP</span><span class=pun>)</span><span class=com>//区间更新</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L7><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>L</span><span class=pun>==</span><span class=pln>l</span><span class=pun>&amp;&amp;</span><span class=pln>r</span><span class=pun>==</span><span class=pln>R</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=typ>Chg</span><span class=pun>(</span><span class=pln>p</span><span class=pun>,</span><span class=pln>x</span><span class=pun>);</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        </span><span class=typ>Down</span><span class=pun>(</span><span class=pln>p</span><span class=pun>);</span><span class=typ>int</span><span class=pln> mid</span><span class=pun>=</span><span class=pln>L</span><span class=pun>+</span><span class=pln>R</span><span class=pun>&gt;&gt;</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>r</span><span class=pun>&lt;=</span><span class=pln>mid</span><span class=pun>)</span><span class=typ>Updata</span><span class=pun>(</span><span class=pln>l</span><span class=pun>,</span><span class=pln>r</span><span class=pun>,</span><span class=pln>x</span><span class=pun>,</span><span class=typ>Lson</span><span class=pun>);</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        </span><span class=kwd>else</span><span class=pln> </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>l</span><span class=pun>&gt;</span><span class=pln>mid</span><span class=pun>)</span><span class=typ>Updata</span><span class=pun>(</span><span class=pln>l</span><span class=pun>,</span><span class=pln>r</span><span class=pun>,</span><span class=pln>x</span><span class=pun>,</span><span class=typ>Rson</span><span class=pun>);</span></code></li><li class=L1><code class=lang-cpp><span class=pln>        </span><span class=kwd>else</span><span class=pln> </span><span class=typ>Updata</span><span class=pun>(</span><span class=pln>l</span><span class=pun>,</span><span class=pln>mid</span><span class=pun>,</span><span class=pln>x</span><span class=pun>,</span><span class=typ>Lson</span><span class=pun>),</span><span class=typ>Updata</span><span class=pun>(</span><span class=pln>mid</span><span class=pun>+</span><span class=lit>1</span><span class=pun>,</span><span class=pln>r</span><span class=pun>,</span><span class=pln>x</span><span class=pun>,</span><span class=typ>Rson</span><span class=pun>);</span></code></li><li class=L2><code class=lang-cpp><span class=pln>        </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]=</span><span class=pln>min</span><span class=pun>(</span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>ls</span><span class=pun>],</span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>rs</span><span class=pun>]);</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L4><code class=lang-cpp><span class=pln>    </span><span class=kwd>void</span><span class=pln> </span><span class=typ>Updata_</span><span class=pun>(</span><span class=typ>int</span><span class=pln> x</span><span class=pun>,</span><span class=typ>int</span><span class=pln> y</span><span class=pun>,</span><span class=pln>LRP</span><span class=pun>)</span><span class=com>//单点更新</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L6><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>L</span><span class=pun>==</span><span class=pln>R</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]+=</span><span class=pln>y</span><span class=pun>,</span><span class=kwd>void</span><span class=pun>();</span></code></li><li class=L7><code class=lang-cpp><span class=pln>        </span><span class=typ>Down</span><span class=pun>(</span><span class=pln>p</span><span class=pun>);</span><span class=typ>int</span><span class=pln> mid</span><span class=pun>=</span><span class=pln>L</span><span class=pun>+</span><span class=pln>R</span><span class=pun>&gt;&gt;</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>x</span><span class=pun>&lt;=</span><span class=pln>mid</span><span class=pun>)</span><span class=typ>Updata_</span><span class=pun>(</span><span class=pln>x</span><span class=pun>,</span><span class=pln>y</span><span class=pun>,</span><span class=typ>Lson</span><span class=pun>);</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        </span><span class=kwd>else</span><span class=pln> </span><span class=typ>Updata_</span><span class=pun>(</span><span class=pln>x</span><span class=pun>,</span><span class=pln>y</span><span class=pun>,</span><span class=typ>Rson</span><span class=pun>);</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]=</span><span class=pln>min</span><span class=pun>(</span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>ls</span><span class=pun>],</span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>rs</span><span class=pun>]);</span></code></li><li class=L1><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    </span><span class=kwd>void</span><span class=pln> </span><span class=typ>Build</span><span class=pun>(</span><span class=pln>LRP</span><span class=pun>)</span><span class=com>//建线段树</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L4><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>L</span><span class=pun>==</span><span class=pln>R</span><span class=pun>)</span></code></li><li class=L5><code class=lang-cpp><span class=pln>        </span><span class=pun>{</span></code></li><li class=L6><code class=lang-cpp><span class=pln>            </span><span class=typ>int</span><span class=pln> u</span><span class=pun>=</span><span class=typ>Re</span><span class=pun>[</span><span class=pln>L</span><span class=pun>];</span></code></li><li class=L7><code class=lang-cpp><span class=pln>            </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]=</span><span class=pln>dis</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]+</span><span class=pln>len</span><span class=pun>[</span><span class=pln>u</span><span class=pun>];</span></code></li><li class=L8><code class=lang-cpp><span class=pln>            </span><span class=kwd>return</span><span class=pln> </span><span class=pun>;</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        </span><span class=pun>}</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        </span><span class=typ>int</span><span class=pln> mid</span><span class=pun>=</span><span class=pln>L</span><span class=pun>+</span><span class=pln>R</span><span class=pun>&gt;&gt;</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L1><code class=lang-cpp><span class=pln>        </span><span class=typ>Build</span><span class=pun>(</span><span class=typ>Lson</span><span class=pun>),</span><span class=typ>Build</span><span class=pun>(</span><span class=typ>Rson</span><span class=pun>);</span></code></li><li class=L2><code class=lang-cpp><span class=pln>        </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]=</span><span class=pln>min</span><span class=pun>(</span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>ls</span><span class=pun>],</span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>rs</span><span class=pun>]);</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L4><code class=lang-cpp><span class=pln>    LL </span><span class=typ>Query</span><span class=pun>(</span><span class=typ>int</span><span class=pln> l</span><span class=pun>,</span><span class=typ>int</span><span class=pln> r</span><span class=pun>,</span><span class=pln>LRP</span><span class=pun>)</span><span class=com>//区间查询</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L6><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>L</span><span class=pun>==</span><span class=pln>l</span><span class=pun>&amp;&amp;</span><span class=pln>r</span><span class=pun>==</span><span class=pln>R</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>];</span></code></li><li class=L7><code class=lang-cpp><span class=pln>        </span><span class=typ>Down</span><span class=pun>(</span><span class=pln>p</span><span class=pun>);</span><span class=typ>int</span><span class=pln> mid</span><span class=pun>=</span><span class=pln>L</span><span class=pun>+</span><span class=pln>R</span><span class=pun>&gt;&gt;</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>r</span><span class=pun>&lt;=</span><span class=pln>mid</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=typ>Query</span><span class=pun>(</span><span class=pln>l</span><span class=pun>,</span><span class=pln>r</span><span class=pun>,</span><span class=typ>Lson</span><span class=pun>);</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>l</span><span class=pun>&gt;</span><span class=pln>mid</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=typ>Query</span><span class=pun>(</span><span class=pln>l</span><span class=pun>,</span><span class=pln>r</span><span class=pun>,</span><span class=typ>Rson</span><span class=pun>);</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        </span><span class=kwd>return</span><span class=pln> min</span><span class=pun>(</span><span class=typ>Query</span><span class=pun>(</span><span class=pln>l</span><span class=pun>,</span><span class=pln>mid</span><span class=pun>,</span><span class=typ>Lson</span><span class=pun>),</span><span class=typ>Query</span><span class=pun>(</span><span class=pln>mid</span><span class=pun>+</span><span class=lit>1</span><span class=pun>,</span><span class=pln>r</span><span class=pun>,</span><span class=typ>Rson</span><span class=pun>));</span></code></li><li class=L1><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    LL </span><span class=typ>Query_</span><span class=pun>(</span><span class=typ>int</span><span class=pln> x</span><span class=pun>,</span><span class=pln>LRP</span><span class=pun>)</span><span class=com>//单点查询</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L4><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>L</span><span class=pun>==</span><span class=pln>R</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=typ>Sum</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]-</span><span class=pln>len</span><span class=pun>[</span><span class=typ>Re</span><span class=pun>[</span><span class=pln>L</span><span class=pun>]];</span></code></li><li class=L5><code class=lang-cpp><span class=pln>        </span><span class=typ>Down</span><span class=pun>(</span><span class=pln>p</span><span class=pun>);</span><span class=typ>int</span><span class=pln> mid</span><span class=pun>=</span><span class=pln>L</span><span class=pun>+</span><span class=pln>R</span><span class=pun>&gt;&gt;</span><span class=lit>1</span><span class=pun>;</span></code></li><li class=L6><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>x</span><span class=pun>&lt;=</span><span class=pln>mid</span><span class=pun>)</span><span class=kwd>return</span><span class=pln> </span><span class=typ>Query_</span><span class=pun>(</span><span class=pln>x</span><span class=pun>,</span><span class=typ>Lson</span><span class=pun>);</span></code></li><li class=L7><code class=lang-cpp><span class=pln>        </span><span class=kwd>return</span><span class=pln> </span><span class=typ>Query_</span><span class=pun>(</span><span class=pln>x</span><span class=pun>,</span><span class=typ>Rson</span><span class=pun>);</span></code></li><li class=L8><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L9><code class=lang-cpp><span class=pun>}</span><span class=pln>T</span><span class=pun>;</span></code></li><li class=L0><code class=lang-cpp><span class=typ>int</span><span class=pln> main</span><span class=pun>()</span></code></li><li class=L1><code class=lang-cpp><span class=pun>{</span></code></li><li class=L2><code class=lang-cpp><span class=pln>    cin</span><span class=pun>&gt;&gt;</span><span class=pln>n</span><span class=pun>&gt;&gt;</span><span class=pln>Q</span><span class=pun>;</span></code></li><li class=L3><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=lit>1</span><span class=pun>;</span><span class=pln>i</span><span class=pun>&lt;</span><span class=pln>n</span><span class=pun>;++</span><span class=pln>i</span><span class=pun>)</span></code></li><li class=L4><code class=lang-cpp><span class=pln>        scanf</span><span class=pun>(</span><span class=str>"%d%d%d"</span><span class=pun>,&amp;</span><span class=pln>U</span><span class=pun>[</span><span class=pln>i</span><span class=pun>],&amp;</span><span class=pln>V</span><span class=pun>[</span><span class=pln>i</span><span class=pun>],&amp;</span><span class=pln>W</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]),</span></code></li><li class=L5><code class=lang-cpp><span class=pln>        </span><span class=typ>Add</span><span class=pun>(</span><span class=pln>U</span><span class=pun>[</span><span class=pln>i</span><span class=pun>],</span><span class=pln>V</span><span class=pun>[</span><span class=pln>i</span><span class=pun>],</span><span class=pln>W</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]),</span><span class=pln>swap</span><span class=pun>(</span><span class=pln>U</span><span class=pun>[</span><span class=pln>i</span><span class=pun>],</span><span class=pln>V</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]);</span></code></li><li class=L6><code class=lang-cpp><span class=pln>    dfs</span><span class=pun>(</span><span class=lit>1</span><span class=pun>,</span><span class=pln>tot</span><span class=pun>=</span><span class=lit>0</span><span class=pun>);</span></code></li><li class=L7><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> i</span><span class=pun>=</span><span class=pln>n</span><span class=pun>;</span><span class=pln>i</span><span class=pun>&lt;=</span><span class=pln>n</span><span class=pun>+</span><span class=pln>n</span><span class=pun>-</span><span class=lit>2</span><span class=pun>;++</span><span class=pln>i</span><span class=pun>)</span></code></li><li class=L8><code class=lang-cpp><span class=pln>        scanf</span><span class=pun>(</span><span class=str>"%d%d%d"</span><span class=pun>,&amp;</span><span class=pln>U</span><span class=pun>[</span><span class=pln>i</span><span class=pun>],&amp;</span><span class=pln>V</span><span class=pun>[</span><span class=pln>i</span><span class=pun>],&amp;</span><span class=pln>W</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]),</span><span class=pln>len</span><span class=pun>[</span><span class=pln>U</span><span class=pun>[</span><span class=pln>i</span><span class=pun>]]=</span><span class=pln>W</span><span class=pun>[</span><span class=pln>i</span><span class=pun>];</span></code></li><li class=L9><code class=lang-cpp><span class=pln>    T</span><span class=pun>.</span><span class=typ>Build</span><span class=pun>();</span></code></li><li class=L0><code class=lang-cpp><span class=pln>    </span><span class=kwd>for</span><span class=pun>(</span><span class=typ>int</span><span class=pln> op</span><span class=pun>,</span><span class=pln>u</span><span class=pun>,</span><span class=pln>v</span><span class=pun>;</span><span class=pln>Q</span><span class=pun>--;)</span></code></li><li class=L1><code class=lang-cpp><span class=pln>    </span><span class=pun>{</span></code></li><li class=L2><code class=lang-cpp><span class=pln>        scanf</span><span class=pun>(</span><span class=str>"%d%d%d"</span><span class=pun>,&amp;</span><span class=pln>op</span><span class=pun>,&amp;</span><span class=pln>u</span><span class=pun>,&amp;</span><span class=pln>v</span><span class=pun>);</span></code></li><li class=L3><code class=lang-cpp><span class=pln>        </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>op</span><span class=pun>==</span><span class=lit>1</span><span class=pun>)</span></code></li><li class=L4><code class=lang-cpp><span class=pln>        </span><span class=pun>{</span></code></li><li class=L5><code class=lang-cpp><span class=pln>            </span><span class=typ>int</span><span class=pln> p</span><span class=pun>=</span><span class=pln>U</span><span class=pun>[</span><span class=pln>u</span><span class=pun>];</span></code></li><li class=L6><code class=lang-cpp><span class=pln>            </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>u</span><span class=pun>&lt;</span><span class=pln>n</span><span class=pun>)</span><span class=pln>T</span><span class=pun>.</span><span class=typ>Updata</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>p</span><span class=pun>],</span><span class=pln>R</span><span class=pun>[</span><span class=pln>p</span><span class=pun>],</span><span class=pln>v</span><span class=pun>-</span><span class=pln>W</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]);</span></code></li><li class=L7><code class=lang-cpp><span class=pln>            </span><span class=kwd>else</span><span class=pln> T</span><span class=pun>.</span><span class=typ>Updata_</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>p</span><span class=pun>],</span><span class=pln>v</span><span class=pun>-</span><span class=pln>W</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]),</span><span class=pln>len</span><span class=pun>[</span><span class=pln>p</span><span class=pun>]=</span><span class=pln>v</span><span class=pun>;</span></code></li><li class=L8><code class=lang-cpp><span class=pln>            W</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]=</span><span class=pln>v</span><span class=pun>;</span></code></li><li class=L9><code class=lang-cpp><span class=pln>        </span><span class=pun>}</span></code></li><li class=L0><code class=lang-cpp><span class=pln>        </span><span class=kwd>else</span></code></li><li class=L1><code class=lang-cpp><span class=pln>            </span><span class=kwd>if</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]&lt;=</span><span class=pln>L</span><span class=pun>[</span><span class=pln>v</span><span class=pun>]&amp;&amp;</span><span class=pln>L</span><span class=pun>[</span><span class=pln>v</span><span class=pun>]&lt;=</span><span class=pln>R</span><span class=pun>[</span><span class=pln>u</span><span class=pun>])</span><span class=com>//v是u的后代</span></code></li><li class=L2><code class=lang-cpp><span class=pln>                printf</span><span class=pun>(</span><span class=str>"%lld\n"</span><span class=pun>,</span><span class=pln>T</span><span class=pun>.</span><span class=typ>Query_</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>v</span><span class=pun>])-</span><span class=pln>T</span><span class=pun>.</span><span class=typ>Query_</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>u</span><span class=pun>]));</span></code></li><li class=L3><code class=lang-cpp><span class=pln>            </span><span class=kwd>else</span><span class=com>//否则求区间最小值</span></code></li><li class=L4><code class=lang-cpp><span class=pln>                printf</span><span class=pun>(</span><span class=str>"%lld\n"</span><span class=pun>,</span><span class=pln>T</span><span class=pun>.</span><span class=typ>Query</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>u</span><span class=pun>],</span><span class=pln>R</span><span class=pun>[</span><span class=pln>u</span><span class=pun>])-</span><span class=pln>T</span><span class=pun>.</span><span class=typ>Query_</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>u</span><span class=pun>])+</span><span class=pln>T</span><span class=pun>.</span><span class=typ>Query_</span><span class=pun>(</span><span class=pln>L</span><span class=pun>[</span><span class=pln>v</span><span class=pun>]));</span></code></li><li class=L5><code class=lang-cpp><span class=pln>    </span><span class=pun>}</span></code></li><li class=L6><code class=lang-cpp><span class=pun>}</span></code></li></ol></pre> </div> </div> <div id=pickup> <div class=stars> <span class></span> </div> 点赞 </div> <script src=https://cdn.jsdelivr.net/npm/jquery@1.11.1/dist/jquery.min.js></script> <script src=https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@5c3956355afede3aa3733467597bca655f633bfb/cb/fd/a7/04/cbfda704333e625c39a933935366104bc5f249f563903479697dd65419c9e599.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@1a3cac13704cfb4581eba7c80d6a17a4875a9cb0/aa/4f/fe/8b/aa4ffe8b05ec5c82ef2083556db92978ff71f9cd0cea5aae897439e2d108405a.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@2a96d3cb5dd059f8251854bb7bee8dbe87a1eb3f/e3/a2/a0/14/e3a2a014ef7afae26a46f7f57eda5c04ab5f82aca421c75c09375957a853c2b1.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@2a0687348c9f51a49c83aefd40db290ce3e53806/01/bb/d6/4e/01bbd64ee83ea0e5328a6b76a71ff3c59471e1a4c60238533211908df7160194.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@e5c61235d73fd4ee4325f30a6a7015e41f4135d6/96/82/6e/d5/96826ed596b183c4fa45ac7cc487e9ef04d642a41cc441aa0e37ce9a220fd60a.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@4a1b5def55a106936540236baee7614eed57ab9e/f1/54/b6/33/f154b633352f533fee95c6d97e7094ec9c4e2440455c49a77f4e4942152a680c.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@3125b34f85e0baf93b75e60a0f5ef3ca86584c3d/6c/36/f3/40/6c36f340c28857f77797084c584ec0ba6d4c70943a106eadabf309c0fbf3e647.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@c86c1bdcba6cd97ce63f15c1be5af0b2c8bb440d/fc/48/48/87/fc484887d4277dcb15dd736f66974dc608579c086fc1e2bd3b221ac3e02d529c.js></script> <script src=https://cdn.jsdelivr.net/gh/urlib/bin_8@e610aa8d166e0be7b5687461949ed4ea5dac9989/b3/67/4c/fe/b3674cfe25895038b937b65fd0465f7bcb8f679f4d2898cb83a111f68e38ae47.js></script> <div id=qds style=display:none;></div></body></html>